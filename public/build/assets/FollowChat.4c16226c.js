import{_ as G}from"./AuthenticatedLayout.0bc0b363.js";import{h as J,j as r,m as p,c as d,w as c,l as g,k as K,r as m,o,a as n,b as f,H as R,d as s,t as S,s as v,n as F,q as W,p as X,F as Y,u as x,L as Z}from"./app.cc606831.js";import"./DialogConfirm.f96873bf.js";const ee={class:"row q-mb-lg"},te={class:"column col-12 col-md-6 justify-center"},ae={class:"app-fs-28 app-fw-700 app-lh-32 text-grey-8"},se={class:"col-12 col-md-6 flex justify-end items-center"},ne=s("div",{class:"q-ml-sm app-fw-500 app-fs-14 app-lh-20"}," sendMessage ",-1),oe=s("div",{class:"q-ml-sm app-fw-500 app-fs-14 app-lh-20"}," Iniciar encontro ",-1),ie=s("div",{class:"q-ml-sm app-fw-500 app-fs-14 app-lh-20"}," Finalizar encontro ",-1),le={class:"q-ml-sm app-fw-500 app-fs-14 app-lh-20"},re={class:"bg-white q-py-lg q-px-lg app-br-16"},de={class:"row justify-center adm-border-dashed-blue app-br-16"},ce={style:{width:"100%","max-width":"80%"}},me={class:"col-12"},fe={__name:"FollowChat",props:{meeting:Object,errors:Object,canMeetingStartFinish:Boolean,canMeetingDetachStudent:Boolean},setup(i){const t=i,q=J(),T=()=>{x().put(route("admin.meeting.start",t.meeting.id),{preserveScroll:!0,onSuccess:()=>{q.notify({type:"positive",message:`Encontro ${t.meeting.name} iniciado.`,position:"top"})}})},z=()=>{x().put(route("admin.meeting.finish",t.meeting.id),{preserveScroll:!0,onSuccess:()=>{q.notify({type:"positive",message:`Encontro ${t.meeting.name} finalizado.`,position:"top"})}})},$=()=>{x().put(route("admin.meeting.toggle-offer-availability",t.meeting.id),{preserveScroll:!0,onSuccess:()=>{let e=t.meeting.offer_available?"liberada":"encerrar";q.notify({type:"positive",message:`Oferta ${e}`,position:"top"})}})},I=()=>{let e=t.meeting.start_at.match(/(\d\d)\/(\d\d)\/(\d\d\d\d) (\d\d):(\d\d)/);const a=g.buildDate({year:e[3],month:e[2],day:e[1],hours:e[4],minutes:e[5],seconds:0});return g.getDateDiff(a,Date.now(),"seconds")};let j=setInterval(()=>{I()<=300&&(clearInterval(j),k.value=!0)},1e3);const O=r(()=>t.meeting.status==="Aberto"),h=r(()=>t.meeting.status==="Iniciado");r(()=>t.meeting.status!=="Finalizado");const k=p(I()<=300),D=r(()=>t.meeting.teacher.id===K().props.value.auth.user.id),V=r(()=>D.value&&k.value&&O.value),L=r(()=>D.value&&h.value),C=()=>{if(!t.meeting.started_at)return"00:00:00";let e=t.meeting.started_at.match(/(\d\d)\/(\d\d)\/(\d\d\d\d) (\d\d):(\d\d):(\d\d)/),a=g.buildDate({year:e[3],month:e[2],day:e[1],hours:e[4],minutes:e[5],seconds:e[6]});return new Date(g.getDateDiff(Date.now(),a,"seconds")*1e3).toISOString().slice(11,19)},E=p(C());let N=setInterval(()=>{h.value?E.value=C():clearInterval(N)},1e3);const M=()=>{let e=t.meeting.end_at.match(/(\d\d)\/(\d\d)\/(\d\d\d\d) (\d\d):(\d\d)/),a=g.buildDate({year:e[3],month:e[2],day:e[1],hours:e[4],minutes:e[5],seconds:0});return new Date>a},_=p(M());let A=setInterval(()=>{_.value?clearInterval(A):_.value=M()},1e3);const B=p([]),u=p(""),H=()=>{Z.post(route("admin.chat-message.send",t.meeting.id),{message:u.value}).then(()=>{u.value=null})};return window.Echo.channel(`chat-message.${t.meeting.id}`).listen(".chat-message",e=>{B.value=e.messages}),(e,a)=>{const w=m("q-breadcrumbs-el"),U=m("q-breadcrumbs"),y=m("q-icon"),b=m("q-btn"),P=m("q-chat-message"),Q=m("q-input");return o(),d(G,null,{default:c(()=>[n(f(R),{title:"Encontro | Editar"}),s("div",ee,[s("div",te,[s("div",ae,S(i.meeting.name),1),n(U,{class:"text-grey q-mt-sm app-fs-13 app-fw-400 app-lh-16",gutter:"xs"},{default:c(()=>[n(w,{label:"Home",class:"text-grey"}),n(w,{label:"Encontros",class:"text-grey"}),n(w,{label:i.meeting.name,class:"text-primary"},null,8,["label"])]),_:1})]),s("div",se,[u.value?(o(),d(b,{key:0,color:"primary",class:"q-mr-md",rounded:"","no-caps":"",outline:"",onClick:H},{default:c(()=>[n(y,{name:"o_play_arrow",size:"xs"}),ne]),_:1})):v("",!0),f(V)?(o(),d(b,{key:1,color:"primary",class:"q-mr-md",rounded:"","no-caps":"",outline:"",onClick:a[0]||(a[0]=l=>T())},{default:c(()=>[n(y,{name:"o_play_arrow",size:"xs"}),oe]),_:1})):v("",!0),f(L)?(o(),d(b,{key:2,color:"negative",class:"q-mr-md",rounded:"","no-caps":"",outline:"",onClick:a[1]||(a[1]=l=>z())},{default:c(()=>[n(y,{name:"close",size:"xs"}),ie]),_:1})):v("",!0),f(h)&&i.meeting.has_live_offer?(o(),d(b,{key:3,color:i.meeting.offer_available?"warning":"primary",rounded:"","no-caps":"",onClick:$,unelevated:""},{default:c(()=>[n(y,{name:i.meeting.offer_available?"money_off":"attach_money",size:"xs"},null,8,["name"]),s("div",le,S(i.meeting.offer_available?"Encerrar oferta":"Liberar oferta"),1)]),_:1},8,["color"])):v("",!0),f(h)?(o(),F("div",{key:4,class:W(["q-mx-md",{"text-primary":!_.value,"text-red":_.value}])},S(E.value),3)):v("",!0)])]),s("div",re,[s("div",de,[s("div",ce,[(o(!0),F(Y,null,X(B.value,l=>(o(),d(P,{name:l.user.name,text:[l.message],sent:l.user.id===e.$page.props.auth.user.id,size:"5"},null,8,["name","text","sent"]))),256))])]),s("div",me,[n(Q,{outlined:"",modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=l=>u.value=l),label:"Mensagem"},null,8,["modelValue"])])])]),_:1})}}};export{fe as default};
